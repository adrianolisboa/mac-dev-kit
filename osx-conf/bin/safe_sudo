#!/usr/bin/env bash

set -euo pipefail

if [[ $# -eq 0 ]]; then
  echo "Usage: safe_sudo <command> [args...]"
  exit 1
fi

render_command() {
  local rendered=""
  local arg
  for arg in "$@"; do
    rendered+=$(printf '%q ' "$arg")
  done
  printf '%s' "${rendered% }"
}

cmd_preview="$(render_command "$@")"
printf "What are you really trying to do?\nRun 'sudo %s'? [y/N]: " "$cmd_preview"
read -r answer

case "${answer:-}" in
  y|Y|yes|YES)
    exec sudo "$@"
    ;;
  *)
    echo "Cancelled."
    exit 1
    ;;
esac
