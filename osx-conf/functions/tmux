# vim: ft=zsh sw=2 ts=2 expandtab
# Credits: https://github.com/thoughtbot/dotfiles/blob/master/bin/tat

not_in_tmux() {
  [[ -z "$TMUX" ]]
}

session_exists() {
  local session_name="$1"
  tmux has-session -t "$session_name" 2>/dev/null
}

create_detached_session() {
  local session_name="$1"
  TMUX='' tmux new-session -Ad -s "$session_name"
}

create_if_needed_and_attach() {
  local path_name session_name
  path_name="$(basename "$PWD" | tr . -)"
  session_name="${1:-$path_name}"

  if not_in_tmux; then
    tmux new-session -As "$session_name"
    return
  fi

  if ! session_exists "$session_name"; then
    create_detached_session "$session_name"
  fi
  tmux switch-client -t "$session_name"
}
